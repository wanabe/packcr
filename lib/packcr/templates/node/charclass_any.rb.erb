if refill_buffer(1) < 1
  throw(<%= onfail %>)
end
<%- if gen.location -%>
@cur_loc = @cur_loc.forward(@buffer, @cur, 1)
<%- end -%>
@cur += 1
