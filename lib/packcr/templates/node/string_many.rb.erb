if (
    pcc_refill_buffer(rctx, <%= n %>) < <%= n %> ||
<%- (n - 1).times do |i| -%>
    (RSTRING_PTR(rb_ivar_get(rctx, rb_intern("@buffer"))) + NUM2SIZET(rb_ivar_get(rctx, rb_intern("@cur"))))[<%= i %>] != '<%= Packcr.escape_character(value[i]) %>' ||
<%- end -%>
    (RSTRING_PTR(rb_ivar_get(rctx, rb_intern("@buffer"))) + NUM2SIZET(rb_ivar_get(rctx, rb_intern("@cur"))))[<%= n - 1 %>] != '<%= s = Packcr.escape_character(value[n - 1]) %>'
) goto L<%= "%04d" % onfail %>;
<%- if gen.location -%>
rb_funcall(rb_ivar_get(rctx, rb_intern("@cur_loc")), rb_ivar_get(rctx, rb_intern("@buffer")), rb_ivar_get(rctx, rb_intern("@cur")), SIZET2NUM(n));
<%- end -%>
rb_ivar_set(rctx, rb_intern("@cur"), SIZET2NUM(NUM2SIZET(rb_ivar_get(rctx, rb_intern("@cur"))) + <%= n %>));
