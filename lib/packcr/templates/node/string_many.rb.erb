if (
  refill_buffer(<%= n %>) < <%= n %> ||
  <%- (n - 1).times do |i| -%>
  @buffer[@cur + <%= i %>] != "<%= Packcr.escape_character(value[i]) %>" ||
  <%- end -%>
  @buffer[@cur + <%= n - 1 %>] != "<%= Packcr.escape_character(value[n - 1]) %>"
)
  throw(<%= onfail %>)
end
<%- if gen.location -%>
@cur_loc.forward(@buffer, @cur, n)
<%- end -%>
@cur += <%= n %>
