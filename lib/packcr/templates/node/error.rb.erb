{
<%= code -%>
    goto L<%= "%04d" % m %>;
L<%= "%04d" % l %>:;
    {
        pcc_thunk_t *const thunk = pcc_thunk__create_leaf(ctx->auxil, pcc_action_<%= gen.rule.name %>_<%= index %>, <%= gen.rule.vars.length %>, <%= gen.rule.capts.length %>);
<%- vars.each do |var| -%>
        thunk->data.leaf.values.buf[<%= var.index %>] = &(chunk->values.buf[<%= var.index %>]);
<%- end -%>
<%- capts.each do |capt| -%>
        thunk->data.leaf.capts.buf[<%= capt.index %>] = &(chunk->capts.buf[<%= capt.index %>]);
<%- end -%>
        thunk->data.leaf.capt0.range.start = NUM2SIZET(rb_ivar_get(chunk->robj, rb_intern("@pos")));
        thunk->data.leaf.capt0.range.end = NUM2SIZET(rb_ivar_get(ctx->robj, rb_intern("@cur")));
<%- if gen.location -%>
        thunk->data.leaf.capt0.range.start_loc = chunk->pos_loc;
        thunk->data.leaf.capt0.range.end_loc = ctx->cur_loc;
<%- end -%>
        thunk->data.leaf.action(ctx, thunk, NULL, 0);
    }
    goto L<%= "%04d" % onfail %>;
L<%= "%04d" % m %>:;
}
