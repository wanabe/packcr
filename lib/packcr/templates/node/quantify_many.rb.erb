1.times do |;p0, p0_loc, n0, i|
  <%- if min > 0 -%>
  p0 = @cur
  <%-   if gen.location -%>
  p0_loc = @cur_loc
  <%-   end -%>
  n0 = chunk.thunks.length
  <%- end -%>
  i = -1
  <%- if max < 0 -%>
  loop do |;pos, p_loc, n, stat|
  <%- else -%>
  <%= max %>.times do |;pos, p_loc, n, stat|
  <%- end -%>
    i += 1
    pos = @cur
    <%- if gen.location -%>
    p_loc = @cur_loc
    <%- end -%>
    n = chunk.thunks.length
    stat = nil
    <%- l = gen.next_label -%>
    catch(<%= l %>) do
      <%- r, code = gen.generate_code_str(expr, l, 6, false) -%>
      <%- %><%= code -%>
      if @cur == pos
        stat = :break
      else
        stat = :continue
      end
    end
    if stat == :break
      break
    <%- if r != Packcr::CODE_REACH__ALWAYS_SUCCEED -%>
    elsif stat != :continue
      @cur = pos
      <%-   if gen.location -%>
      @cur_loc = p_loc
      <%-   end -%>
      chunk.thunks[n..-1] = []
      break
    <%- end -%>
    end
  end
  <%- if min > 0 -%>
  if i < <%= min %>
    @cur = p0
    <%-   if gen.location -%>
    @cur_loc = p0_loc
    <%-   end -%>
    chunk.thunks[n0..-1] = []
    throw(<%= onfail %>)
  end
  <%- end -%>
end
