capt<%= gen.level %> = answer.capts[<%= index %>]
n<%= gen.level %> = capt<%= gen.level %>.range_end - capt<%= gen.level %>.range_start
if refill_buffer(n<%= gen.level %>) < n<%= gen.level %>
  throw(<%= onfail %>)
end
if n<%= gen.level %> > 0
  ptr<%= gen.level %> = @buffer[@position_offset, n<%= gen.level %>]
  q<%= gen.level %> = @buffer[capt<%= gen.level %>.range_start, n<%= gen.level %>]
  if ptr<%= gen.level %> != q<%= gen.level %>
    throw(<%= onfail %>)
  end
  <%- if gen.location -%>
  @position_offset_loc = @position_offset_loc.forward(@buffer, @position_offset, n<%= gen.level %>)
  <%- end -%>
  @position_offset += n<%= gen.level %>
end
