<%- if min > 0 -%>
let p0 = self.input.position_offset;
<%-   if gen.location -%>
TODO
<%-   end -%>
<%- end -%>
<%- use_count = max >= 0 || min > 0 -%>
<%- if use_count -%>
let mut i = -1;
<%- end -%>
<%- m = gen.next_label -%>
catch(||{
    loop {
        <%- if use_count -%>
        i += 1;
        <%- end -%>
        <%- if max >= 0 -%>
        if i >= <%= max %> {
            return NOP;
        }
        <%- end -%>
        let p = self.input.position_offset;
        <%- if r != Packcr::CODE_REACH__ALWAYS_SUCCEED -%>
        <%-   if gen.location -%>
        TODO
        <%-   end -%>
        <%- end -%>
        <%- l = gen.next_label -%>
        <%- r = expr.reachability -%>
        <%- if r == Packcr::CODE_REACH__ALWAYS_SUCCEED -%>
        TODO
        match (||{
            <%- %><%= gen.generate_code(expr, l, 12, false) -%>
            if self.input.position_offset == p {
                return throw(<%= m %>);
            }
        })() {
            NOP => continue,
            Err(label) if label != <%= l %> => return throw(label),
            _ => {
                self.input.position_offset = p;
                <%-   if gen.location -%>
                TODO
                <%-   end -%>
                return throw(<%= m %>);
            }
        }
        <%- else -%>
        match (||{
            <%- %><%= gen.generate_code(expr, l, 12, false) -%>
            if self.input.position_offset == p {
                return throw(<%= m %>);
            }
            NOP
        })() {
            NOP => continue,
            Err(label) if label != <%= l %> => return throw(label),
            _ => {
                self.input.position_offset = p;
                <%-   if gen.location -%>
                TODO
                <%-   end -%>
                return throw(<%= m %>);
            }
        }
        <%- end -%>
    }
}, <%= m %>)?;
<%- if min > 0 -%>
if i < <%= min %> {
    self.input.position_offset = p0;
    <%-   if gen.location -%>
    TODO
    <%-   end -%>
    return throw(<%= onfail %>);
}
<%- end -%>
