    {
        const size_t p = NUM2SIZET(rb_ivar_get(ctx->robj, rb_intern("@cur")));
<%- if gen.location -%>
        const VALUE p_loc = rb_ivar_get(ctx->robj, rb_intern("@cur_loc"));
<%- end -%>
        const size_t n = RARRAY_LEN(rb_ivar_get(chunk->robj, rb_intern("@thunks")));
<%- nodes.each_with_index do |expr, i| -%>
<%-   c = i + 1 < nodes.length -%>
<%-   l = gen.next_label -%>
<%-   r, code = gen.generate_code_str(expr, l, 8, false) -%>
<%= code -%>
<%-   if r == Packcr::CODE_REACH__ALWAYS_SUCCEED -%>
<%-     reach = Packcr::CODE_REACH__ALWAYS_SUCCEED -%>
<%-     if c -%>
        /* unreachable codes omitted */
<%-     end -%>
<%-     break -%>
<%-   else -%>
<%-     if r == Packcr::CODE_REACH__BOTH -%>
<%-       reach = Packcr::CODE_REACH__BOTH -%>
<%-       b = true -%>
        goto L<%= "%04d" % m %>;
<%-     end -%>
<%-   end -%>
    L<%= "%04d" % l %>:;
        rb_ivar_set(ctx->robj, rb_intern("@cur"), SIZET2NUM(p));
<%- if gen.location -%>
        rb_ivar_set(ctx->robj, rb_intern("@cur_loc"), p_loc);
<%- end -%>
        rb_funcall(rb_ivar_get(chunk->robj, rb_intern("@thunks")), rb_intern("[]="), 3, SIZET2NUM(n), SIZET2NUM(65535), rb_ary_new());
<%-   if !c -%>
        goto L<%= "%04d" % onfail %>;
<%-   end -%>
<%- end -%>
    L<%= "%04d" % m %>:;
    }
