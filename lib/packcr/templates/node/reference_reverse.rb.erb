<%- if index != nil -%>
if limits && @position_offset == offset && !limits[:evaluate_rule_<%= name %>]
  if apply_rule(:evaluate_rule_<%= name %>, answer.thunks, answer.values, <%= index %>, offset<% if gen.location %>, offset_loc<% end %>, limits: limits)
    throw(<%= onsuccess %>)
  end
elsif apply_rule(:evaluate_rule_<%= name %>, answer.thunks, answer.values, <%= index %>, offset<% if gen.location %>, offset_loc<% end %>)
  throw(<%= onsuccess %>)
end
<%- else -%>
if limits && @position_offset == offset && !limits[:evaluate_rule_<%= name %>]
  if apply_rule(:evaluate_rule_<%= name %>, answer.thunks, nil, 0, offset<% if gen.location %>, offset_loc<% end %>, limits: limits)
    throw(<%= onsuccess %>)
  end
elsif apply_rule(:evaluate_rule_<%= name %>, answer.thunks, nil, 0, offset<% if gen.location %>, offset_loc<% end %>)
  throw(<%= onsuccess %>)
end
<%- end -%>
